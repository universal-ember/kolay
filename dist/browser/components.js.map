{"version":3,"file":"components.js","sources":["../../src/browser/components/group-nav.gts","../../src/browser/components/logs.gts","../../src/browser/components/page.gts","../../src/browser/components/page-nav.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { service } from '@ember/service';\n\nimport { docsManager } from '../services/docs.ts';\n\nimport type RouterService from '@ember/routing/router-service';\n\nexport class GroupNav extends Component<{\n  /**\n   * The `<nav>` element. It has a default `aria-label` of \"Groups\".\n   * Normally an `aria-label` is not required,\n   * but when there are multiple `<nav>` elements on a screen, it is required.\n   */\n  Element: HTMLElement;\n  Args: {\n    /**\n     * The class to apply to the `<a>` element when its link is active.\n     *\n     * Defaults to \"active\"\n     */\n    activeClass?: string;\n    /**\n     * The text to use for the \"/\" link.\n     *\n     * Defaults to \"Home\".\n     * This type of link is commonly set to the library name.\n     */\n    homeName?: string;\n  };\n  Blocks: {\n    /**\n     * If you'd like to customize how the links are formatted,\n     * you may pass a block which which will have the name of each link\n     * yielded to it.\n     *\n     * Example:\n     * ```gjs\n     * import { GroupNav } from 'kolay/components';\n     *\n     * const format = text => text.toUpperCase();\n     *\n     * <template>\n     *   <GroupNav as |name|>\n     *     {{format name}}\n     *   </GroupNav>\n     * </template>\n     * ```\n     */\n    default: [name: string];\n  };\n}> {\n  get #docs() {\n    return docsManager(this);\n  }\n\n  @service declare router: RouterService;\n\n  get homeName() {\n    return this.args.homeName ?? 'Home';\n  }\n\n  get rootURL() {\n    return this.router.rootURL;\n  }\n\n  get groups() {\n    return this.#docs.availableGroups.map((groupName) => {\n      if (groupName === 'root') return { text: this.homeName, value: '/' };\n\n      return { text: groupName, value: groupName };\n    });\n  }\n\n  isActive = (subPath: string) => {\n    if (subPath === '/') return false;\n\n    return this.router.currentURL?.startsWith(subPath);\n  };\n\n  get activeClass() {\n    return this.args.activeClass ?? 'active';\n  }\n\n  <template>\n    <nav aria-label='Groups' ...attributes>\n      <ul>\n        {{#each this.groups as |group|}}\n          <li>\n            <a\n              href='{{this.rootURL}}{{group.value}}'\n              class={{if (this.isActive group.value) this.activeClass}}\n            >\n\n              {{#if (has-block)}}\n                {{yield group.text}}\n              {{else}}\n                {{group.text}}\n              {{/if}}\n\n            </a>\n          </li>\n        {{/each}}\n      </ul>\n    </nav>\n  </template>\n}\n","/* eslint-disable no-console */\nimport Component from '@glimmer/component';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport { Scroller } from 'ember-primitives/components/scroller';\nimport { TrackedArray } from 'tracked-built-ins';\n\nimport type { TOC } from '@ember/component/template-only';\n\nconst original = {\n  log: console.log,\n  warn: console.warn,\n  error: console.error,\n  debug: console.debug,\n  info: console.info,\n} as const;\n\ntype Levels = keyof typeof original;\n\nconst LEVELS = Object.keys(original) as Levels[];\n\nconst formatter = new Intl.DateTimeFormat('en-GB', {\n  hour: 'numeric',\n  minute: 'numeric',\n  second: 'numeric',\n  fractionalSecondDigits: 2,\n});\n\nconst format = (date: Date) => formatter.format(date);\n\ninterface Log {\n  level: string;\n  timestamp: Date;\n  message: string;\n}\n\nconst LogList: TOC<{\n  Args: {\n    logs: Log[];\n  };\n}> = <template>\n  <Scroller class='kolay__log-list__scroll' as |x|>\n    {{#each @logs as |logEntry|}}\n      <div class='kolay__log-list__level {{logEntry.level}}'>\n        <span class='kolay__log-list__time'>{{format logEntry.timestamp}}</span>\n        <span>{{logEntry.message}}</span>\n      </div>\n      {{(x.scrollToBottom)}}\n    {{/each}}\n  </Scroller>\n\n  {{! prettier-ignore-start }}\n  <style>\n    .kolay__log-list__scroll {\n      position: relative;\n      overflow: auto;\n      max-height: 10rem;\n      filter: invert(1);\n      .kolay__log-list__level {\n        display: flex;\n        gap: 0.5rem;\n      }\n      .kolay__log-list__time {\n        border-right: 1px solid;\n        padding-right: 0.5rem;\n      }\n    }\n  </style>\n  {{! prettier-ignore-end }}\n</template>;\n\nexport class Logs extends Component {\n  logs = new TrackedArray<Log>();\n\n  constructor(...args: ConstructorParameters<typeof Component>) {\n    super(...args);\n\n    registerDestructor(this, () => LEVELS.forEach((level) => (console[level] = original[level])));\n\n    for (const level of LEVELS) {\n      console[level] = (...messageParts: unknown[]) => {\n        // If our thing fails, we want the normal\n        // log to still happen, just in case.\n        // Makes debugging easier\n        original[level](...messageParts);\n\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        (async () => {\n          // We need to await here, so\n          // we don't break {{log thing}} usage\n          await Promise.resolve();\n\n          this.logs.push({\n            level,\n            message: messageParts.join(' '),\n            timestamp: new Date(),\n          });\n        })();\n      };\n    }\n  }\n\n  <template>\n    <div class='kolay__in-viewport__logs'>\n      <LogList @logs={{this.logs}} />\n    </div>\n    {{! prettier-ignore-start }}\n    <style>\n      .kolay__in-viewport__logs {\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        padding: 0.5rem;\n        border: 1px solid gray;\n        background: currentColor;\n        filter: invert(1);\n      }\n    </style>\n    {{! prettier-ignore-end }}\n  </template>\n}\n","import Component from '@glimmer/component';\n\nimport { selected } from '../services/selected.ts';\n\nimport type { ComponentLike } from '@glint/template';\n\nexport class Page extends Component<{\n  Blocks: {\n    /**\n     * If there was a compilation error, the `<:error>` block\n     * will be active and pass the caller the error text from the compiler.\n     *\n     * Example:\n     *\n     * ```gjs\n     * import { Page } from 'kolay/components';\n     *\n     * <template>\n     *   <Page>\n     *     <:error as |errorText|>\n     *\n     *       {{errorText}}\n     *\n     *     </:error>\n     *     <:success></:success>\n     *   </Page>\n     * </template>\n     * ```\n     */\n    error: [error: string | { reason: string; original: Error }];\n\n    /**\n     * Before the document is compiled (or errored), this block will be active.\n     *\n     * Example:\n     *\n     * ```gjs\n     * import { Page } from 'kolay/components';\n     *\n     * <template>\n     *   <Page>\n     *     <:pending>\n     *        Loading State\n     *     </:pending>\n     *     <:success></:success>\n     *   </Page>\n     * </template>\n     * ```\n     */\n    pending: [];\n\n    /**\n     * If compilation of the active page was successful, the `<:success>` black\n     * will be active, and will pass the component reference to the caller.\n     *\n     * Example:\n     * ```gjs\n     * import { Page } from 'kolay/components';\n     *\n     * <template>\n     *   <Page>\n     *     <:error></:error>\n     *     <:success as |prose|>\n     *\n     *       <prose />\n     *\n     *     </:success>\n     *   </Page>\n     * </template>\n     * ```\n     */\n    success: [prose: ComponentLike];\n  };\n}> {\n  <template>\n    {{#if this.selected.hasError}}\n      {{yield this.selected.error to='error'}}\n    {{/if}}\n\n    {{#if this.selected.isPending}}\n      {{yield to='pending'}}\n    {{/if}}\n\n    {{#if this.selected.prose}}\n      {{yield this.selected.prose to='success'}}\n    {{/if}}\n  </template>\n\n  private get selected() {\n    return selected(this);\n  }\n}\n\nexport default Page;\n","import Component from '@glimmer/component';\nimport { hash } from '@ember/helper';\nimport { service } from '@ember/service';\n\nimport { docsManager } from '../services/docs.ts';\nimport { getIndexPage, isCollection, isIndex } from '../utils.ts';\n\nimport type { Collection, Page } from '../../types.ts';\nimport type { TOC } from '@ember/component/template-only';\nimport type RouterService from '@ember/routing/router-service';\nimport type { ComponentLike } from '@glint/template';\n\ntype InternalPageYield = {\n  page: Page;\n  Link: ComponentLike<{\n    Element: HTMLAnchorElement;\n    Blocks: { default: [page: Page, isActive: boolean] };\n  }>;\n};\n\nexport class PageNav extends Component<{\n  /**\n   * The `<nav>` element. It has a default `aria-label` of \"Selected Group\".\n   * Normally an `aria-label` is not required,\n   * but when there are multiple `<nav>` elements on a screen, it is required.\n   */\n  Element: HTMLElement;\n  Args: {\n    /**\n     * The class to apply to the `<a>` element when its link is active.\n     *\n     * Defaults to \"active\"\n     */\n    activeClass?: string;\n  };\n  Blocks: {\n    /**\n     * If provided, this block will yield back the page for customizing the name and element.\n     * By default the `name` property will be used in a link.\n     *\n     * Example:\n     * ```gjs live preview\n     * import { PageNav } from 'kolay/components';\n     * import { nameFor } from '#docs/demo-support';\n     *\n     * <template>\n     *   <PageNav>\n     *     <:page as |x|>\n     *       <pre>{{JSON.stringify x.page null 3}}</pre>\n     *       <page.Link>\n     *         {{nameFor x.page}}\n     *       </page.Link>\n     *     </:page>\n     *   </PageNav>\n     *   <style>@scope { pre { max-height: 200px; } ul { display: grid; }}</style>\n     * </template>\n     * ```\n     */\n    page: [\n      {\n        page: Page;\n        Link: ComponentLike<{\n          Element: HTMLAnchorElement;\n          Blocks: { default: [page: Page, isActive: boolean] };\n        }>;\n      },\n    ];\n    /**\n     * If provided, this block will yield back the collection for customizing the name.\n     * By default the `name` property will be used or a link will be rendered if an index page is present..\n     *\n     * Example:\n     * ```gjs live preview\n     * import { PageNav } from 'kolay/components';\n     * import { sentenceCase } from '#docs/demo-support';\n     *\n     * <template>\n     *   <PageNav>\n     *     <:collection as |x|>\n     *       <pre>{{JSON.stringify x null 3}}</pre>\n     *       {{#if x.index}}\n     *         <x.index.Link>\n     *           {{sentenceCase x.collection.name}}\n     *         </x.index.Link>\n     *       {{else}}\n     *         {{sentenceCase x.collection.name}}\n     *       {{/if}}\n     *     </:collection>\n     *   </PageNav>\n     *   <style>@scope { pre { max-height: 200px; } ul { display: grid; }}</style>\n     * </template>\n     * ```\n     */\n    collection: [\n      {\n        collection: Collection;\n        /**\n         * If there is an index page, it'll be provided here,\n         * and omitted from the :page block.\n         */\n        index?: {\n          page: Page;\n          Link: ComponentLike<{\n            Element: HTMLAnchorElement;\n            Blocks: { default: [page: Page, isActive: boolean] };\n          }>;\n        };\n      },\n    ];\n  };\n}> {\n  private get docs() {\n    return docsManager(this);\n  }\n\n  /**\n   * Ember doesn't yet have a way to forward blocks,\n   * so we have  to do this weird manualy forwarding ourselves\n   *\n   * This is extra annoying since Pages is a recursive component.\n   */\n  <template>\n    {{!log this.docs}}\n    <nav aria-label='Selected Group' ...attributes>\n      <Pages @item={{this.docs.tree}}>\n\n        <:page as |p|>\n          {{#if (has-block 'page')}}\n            {{yield p to='page'}}\n          {{else}}\n            <p.Link>\n              {{p.page.name}}\n            </p.Link>\n          {{/if}}\n        </:page>\n\n        <:collection as |c|>\n          {{#if (has-block 'collection')}}\n            {{yield c to='collection'}}\n          {{else}}\n            {{#if c.index}}\n              <c.index.Link>\n                {{c.index.page.name}}\n              </c.index.Link>\n            {{else}}\n              {{c.collection.name}}\n            {{/if}}\n          {{/if}}\n        </:collection>\n      </Pages>\n    </nav>\n  </template>\n}\n\nconst not = (x: unknown) => !x;\n\nconst Pages: TOC<{\n  Args: {\n    item: Page | Collection;\n    activeClass?: string;\n  };\n  Blocks: {\n    page: [InternalPageYield];\n    collection: [\n      {\n        collection: Collection;\n        index?: InternalPageYield;\n      },\n    ];\n  };\n}> = <template>\n  {{#if (isCollection @item)}}\n    <ul>\n      {{#each @item.pages as |page|}}\n        {{#if (not (isIndex page))}}\n          <li>\n            {{#if (isCollection page)}}\n\n              {{! index.md pages can make the whole collection clickable }}\n              {{#let (getIndexPage page) as |indexPage|}}\n                {{#if indexPage}}\n                  {{yield\n                    (hash\n                      collection=page\n                      index=(hash\n                        page=indexPage\n                        Link=(component PageLink item=indexPage activeClass=@activeClass)\n                      )\n                    )\n                    to='collection'\n                  }}\n                {{else}}\n                  {{yield (hash collection=page) to='collection'}}\n                {{/if}}\n              {{/let}}\n            {{/if}}\n\n            <Pages @item={{page}}>\n              <:page as |p|>{{yield p to='page'}}</:page>\n              <:collection as |c|>{{yield c to='collection'}}</:collection>\n            </Pages>\n          </li>\n        {{/if}}\n      {{/each}}\n    </ul>\n  {{else}}\n    {{yield\n      (hash page=@item Link=(component PageLink item=@item activeClass=@activeClass))\n      to='page'\n    }}\n  {{/if}}\n</template>;\n\nclass PageLink extends Component<{\n  Element: HTMLAnchorElement;\n  Args: {\n    item: Page;\n    activeClass?: string | undefined;\n  };\n  Blocks: { default: [page: Page, isActive: boolean] };\n}> {\n  @service declare router: RouterService;\n\n  get activeClass() {\n    return this.args.activeClass ?? 'active';\n  }\n\n  get isActive() {\n    const subPath = this.args.item.path;\n\n    if (subPath === '/') return false;\n\n    return this.router.currentURL?.startsWith(subPath) ?? false;\n  }\n\n  <template>\n    <a href={{@item.path}} class={{if this.isActive this.activeClass}} ...attributes>{{yield\n        @item\n        this.isActive\n      }}</a>\n  </template>\n}\n"],"names":["GroupNav","Component","#docs","docsManager","g","prototype","service","i","homeName","args","rootURL","router","groups","availableGroups","map","groupName","text","value","isActive","subPath","currentURL","startsWith","activeClass","setComponentTemplate","precompileTemplate","strictMode","original","log","console","warn","error","debug","info","LEVELS","Object","keys","formatter","Intl","DateTimeFormat","hour","minute","second","fractionalSecondDigits","format","date","LogList","scope","Scroller","templateOnly","Logs","logs","TrackedArray","constructor","registerDestructor","forEach","level","messageParts","Promise","resolve","push","message","join","timestamp","Date","Page","selected","PageNav","docs","Pages","not","x","isCollection","isIndex","getIndexPage","hash","PageLink","item","path"],"mappings":"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"}
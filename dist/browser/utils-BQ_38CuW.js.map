{"version":3,"file":"utils-BQ_38CuW.js","sources":["../../src/browser/services/selected.ts","../../src/browser/services/docs.ts","../../src/browser/utils.ts"],"sourcesContent":["import { cached } from '@glimmer/tracking';\nimport { createCache, getValue } from '@glimmer/tracking/primitives/cache';\nimport { assert } from '@ember/debug';\nimport { getOwner } from '@ember/owner';\nimport { service } from '@ember/service';\n\nimport { createStore } from 'ember-primitives/store';\nimport { use } from 'ember-resources';\nimport { getPromiseState } from 'reactiveweb/get-promise-state';\nimport { keepLatest } from 'reactiveweb/keep-latest';\n\nimport { compileText } from './compiler/reactive.ts';\nimport { docsManager } from './docs.ts';\nimport { getKey } from './lazy-load.ts';\n\nimport type { Page } from '../../types.ts';\nimport type RouterService from '@ember/routing/router-service';\nimport type { ComponentLike } from '@glint/template';\n\nexport function selected(context: unknown) {\n  const owner = getKey(context);\n\n  return createStore(owner, Selected);\n}\n\ntype File = { default: string | ComponentLike };\ntype Loader = () => Promise<File>;\n\n/**\n * With .gjs.md and .gts.md documents, we have only one promise to deal with.\n * With .md documents, we have two promises.\n *\n * .gjs.md / .gts.md:\n *  1. the request to get the module\n *\n * .md\n *  1. the request to get the module\n *  2. compile\n */\nfunction loaderFor(selected: Selected, path: string | undefined) {\n  if (!path) return;\n\n  const docs = selected.compiledDocs;\n  const owner = getOwner(selected);\n\n  /**\n   * NOTE: we support paths with and withouth the '.md' on the URL\n   */\n  const fn = docs[path] ?? docs[path + '.md'];\n\n  async function wrapper(): Promise<ComponentLike | undefined> {\n    if (!fn) return;\n\n    assert(`[Bug] Owner is missing`, owner);\n\n    const module = await fn();\n\n    if (typeof module.default === 'string') {\n      const state = compileText(owner, module.default);\n\n      return state.promise;\n    }\n\n    return module.default;\n  }\n\n  const wrapped = getPromiseState(wrapper);\n\n  return wrapped;\n}\n\nclass Selected {\n  @service declare router: RouterService;\n\n  compiledDocs: Record<string, Loader> = {};\n\n  get #docs() {\n    return docsManager(this);\n  }\n\n  @cached\n  get loader() {\n    return loaderFor(this, this.#matchOrFirstPagePath);\n  }\n\n  /*********************************************************************\n   * This is a pattern to help reduce flashes of content during\n   * the intermediate states of the above request fetchers.\n   * When a new request starts, we'll hold on the old value for as long as\n   * we can, and only swap out the old data when the new data is done loading.\n   *\n   ********************************************************************/\n  @use activeCompiled = keepLatest({\n    value: () => this.loader,\n    when: () => Boolean(this.loader?.isLoading),\n  });\n\n  get prose() {\n    if (this.error) {\n      return;\n    }\n\n    return this.activeCompiled?.resolved;\n  }\n\n  get isReady() {\n    return Boolean(this.activeCompiled?.resolved);\n  }\n\n  get isPending() {\n    return !this.isReady;\n  }\n\n  get hasError() {\n    if (this.error) {\n      return Boolean(this.error);\n    }\n\n    return Boolean(this.activeCompiled?.error);\n  }\n\n  @cached\n  get error() {\n    if (!this.#page) {\n      const message = `Page not found for path \"${this.#path}\". (Using group: \"${this.#docs.currentGroup.name}\", see console for more information)`;\n\n      this.#printError(message);\n\n      return message;\n    }\n\n    const error = this.activeCompiled?.error ? String(this.activeCompiled?.error) : '';\n\n    if (!error) return '';\n\n    this.#printError(`An error occurred`, error);\n\n    return error;\n  }\n\n  get hasProse() {\n    return Boolean(this.prose);\n  }\n\n  get #path(): string | undefined {\n    if (!this.router.currentURL) return;\n\n    const url = new URL(this.router.currentURL, window.location.origin);\n    const path = url.pathname;\n\n    if (path === '/') {\n      return;\n    }\n\n    return path?.replace(/\\.md$/, '');\n  }\n\n  get #matchOrFirstPagePath() {\n    return this.#page?.path ?? this.#docs.pages[0]?.path;\n  }\n\n  #pageCache = createCache(() => {\n    if (!this.#path) return;\n\n    return this.#docs.findByPath(this.#path);\n  });\n\n  get #page(): Page | undefined {\n    return getValue(this.#pageCache);\n  }\n\n  #printError(message: string, error?: unknown) {\n    console.group(message);\n\n    if (error) {\n      console.error(error);\n    }\n\n    console.group('manifest');\n    console.info(this.#docs.manifest);\n    console.groupEnd();\n    console.group('pages');\n    console.info(this.#docs.pages);\n    console.groupEnd();\n    console.groupEnd();\n  }\n}\n","import { cached } from '@glimmer/tracking';\nimport { assert } from '@ember/debug';\nimport { service } from '@ember/service';\n\nimport { Shadowed } from 'ember-primitives/components/shadowed';\nimport { createStore } from 'ember-primitives/store';\nimport { type ModuleMap, type ScopeMap, setupCompiler } from 'ember-repl';\n\nimport { APIDocs, CommentQuery } from '../typedoc/renderer.gts';\nimport { ComponentSignature } from '../typedoc/signature/component.gts';\nimport { HelperSignature } from '../typedoc/signature/helper.gts';\nimport { ModifierSignature } from '../typedoc/signature/modifier.gts';\nimport { typedocLoader } from './api-docs.ts';\nimport { getKey } from './lazy-load.ts';\nimport { selected } from './selected.ts';\n\nimport type { LoadManifest, LoadTypedoc, Manifest } from '../../types.ts';\nimport type RouterService from '@ember/routing/router-service';\nimport type { ComponentLike } from '@glint/template';\n\nexport type SetupOptions = Parameters<DocsService['setup']>[0];\n\nexport function docsManager(context: unknown) {\n  const owner = getKey(context);\n\n  return createStore(owner, DocsService);\n}\n\nexport const LOAD_MANIFEST = Symbol('__KOLAY__LOAD_MANIFEST__');\nexport const PREPARE_DOCS = Symbol('__KOLAY__PREPARE_DOCS__');\n\nexport function compilerOptions({\n  topLevelScope,\n  remarkPlugins,\n  rehypePlugins,\n  modules,\n}: {\n  topLevelScope?: ScopeMap;\n  modules?: ModuleMap;\n  remarkPlugins?: unknown[];\n  rehypePlugins?: unknown[];\n} = {}) {\n  const md = {\n    remarkPlugins,\n    rehypePlugins,\n  };\n  const scope = {\n    Shadowed,\n    APIDocs,\n    CommentQuery,\n    ComponentSignature,\n    ModifierSignature,\n    HelperSignature,\n    ...topLevelScope,\n  };\n\n  return {\n    options: {\n      md,\n      gmd: {\n        scope,\n        ...md,\n      },\n      hbs: {\n        scope,\n      },\n    },\n    modules: {\n      kolay: () => import('../index.ts'),\n      'kolay/components': () => import('../components.ts'),\n      'kolay/typedoc': () => import('../typedoc/index.ts'),\n      ...modules,\n    },\n  };\n}\n\nclass DocsService {\n  @service declare router: RouterService;\n\n  private get apiDocs() {\n    return typedocLoader(this);\n  }\n\n  get #selected() {\n    return selected(this);\n  }\n\n  _docs: Manifest | undefined;\n\n  loadManifest: LoadManifest = () => Promise.resolve({ groups: [] });\n\n  setup = async (options: {\n    /**\n     * The module of the api docs virtual module.\n     * This should be set to `await import('kolay/api-docs:virtual')\n     */\n    apiDocs?: Promise<{ packageNames: string[]; loadApiDocs: LoadTypedoc }>;\n\n    /**\n     * The module of the compiled docs virtual module.\n     * This should be set to `await import('kolay/compiled-docs:virtual')\n     */\n    compiledDocs?: {\n      manifest: Manifest;\n      pages: Record<string, () => Promise<{ default: ComponentLike }>>;\n    };\n\n    /**\n     * Additional invokables that you'd like to have access to\n     * in the markdown, without a codefence.\n     *\n     * By default, the fallowing is available:\n     * - for escaping styles / having a clean style-sandbox\n     *   - <Shadowed>\n     * - for rendering your typedoc:\n     *   - <APIDocs>\n     *   - <ComponentSignature>\n     */\n    topLevelScope?: ScopeMap;\n\n    /**\n     * Additional modules you'd like to be able to import from.\n     * This is in addition the the default modules provided by ember,\n     * and allows you to have access to private libraries without\n     * needing to publish those libraries to NPM.\n     */\n    modules?: ModuleMap;\n\n    /**\n     * Provide additional remark plugins to the default markdown compiler.\n     *\n     * These can be used to add features like notes, callouts, footnotes, etc\n     */\n    remarkPlugins?: unknown[];\n    /**\n     * Provide additional rehype plugins to the default html compiler.\n     *\n     * These can be used to add features syntax-highlighting to pre elements, etc\n     */\n    rehypePlugins?: unknown[];\n  }) => {\n    const [apiDocs, compiledDocs] = await Promise.all([options.apiDocs, options.compiledDocs]);\n\n    this[PREPARE_DOCS](apiDocs, compiledDocs);\n\n    const optionsForCompiler = compilerOptions({\n      topLevelScope: options.topLevelScope,\n      remarkPlugins: options.remarkPlugins ?? [],\n      rehypePlugins: options.rehypePlugins ?? [],\n      modules: options.modules,\n    });\n\n    setupCompiler(this, optionsForCompiler);\n\n    // type-narrowed version of _docs, above\n    return this.manifest;\n  };\n\n  [PREPARE_DOCS](\n    apiDocs: { packageNames: string[]; loadApiDocs: LoadTypedoc } | undefined,\n    compiledDocs:\n      | {\n          manifest: Manifest;\n          pages: Record<string, () => Promise<{ default: ComponentLike }>>;\n        }\n      | undefined\n  ) {\n    if (apiDocs) {\n      this.apiDocs._packages = apiDocs.packageNames;\n      this.apiDocs.loadApiDocs = apiDocs.loadApiDocs;\n    }\n\n    if (compiledDocs?.pages) {\n      this.#selected.compiledDocs = compiledDocs.pages;\n    }\n\n    if (compiledDocs?.manifest) {\n      this._docs = compiledDocs.manifest;\n    }\n  }\n\n  get docs() {\n    assert(\n      `Docs' manifest was not loaded. Be sure to call setup() before accessing anything on the docs service.`,\n      this._docs\n    );\n\n    return this._docs;\n  }\n\n  get manifest() {\n    return this.docs;\n  }\n\n  /**\n   * The flat list of all pages for the current group.\n   * Each page knows the name of its immediate parent.\n   */\n  get pages() {\n    return this.currentGroup?.list ?? [];\n  }\n\n  /**\n   * The full page hierachy for the current group.\n   */\n  get tree() {\n    return this.currentGroup?.tree ?? {};\n  }\n\n  /**\n   * We use the URL for denoting which group we're looking at.\n   * The first segment of the URL will either be a group,\n   * or part of the path segment on the root namespace.\n   *\n   * This does open us up for collisions, so maybe\n   * we'll need to alias \"root\" with something, or at\n   * the very least not use a non-path segement for it.\n   */\n  get selectedGroup() {\n    const [, /* leading slash */ first] = this.router.currentURL?.split('/') || [];\n\n    if (!first) return this.availableGroups[0];\n\n    if (!this.availableGroups.includes(first)) return this.availableGroups[0];\n\n    return first;\n  }\n\n  selectGroup = (group: string) => {\n    assert(\n      `Expected group name, ${group}, to be one of ${this.availableGroups.join(', ')}`,\n      this.availableGroups.includes(group)\n    );\n\n    if (group === 'root') {\n      this.router.transitionTo('/');\n\n      return;\n    }\n\n    this.router.transitionTo(`/${group}`);\n  };\n\n  get availableGroups() {\n    const groups = this.manifest?.groups ?? [];\n\n    return groups.map((group) => group.name);\n  }\n\n  @cached\n  get currentGroup() {\n    return this.groupFor(this.selectedGroup);\n  }\n\n  groupFor = (groupName: string | undefined) => {\n    const groups = this.manifest?.groups ?? [];\n\n    const group = groups.find((group) => group.name === groupName);\n\n    assert(\n      `Could not find group in manifest under the name ${groupName}. The available groups are: ${groups.map((group) => group.name).join(', ')}`,\n      group\n    );\n\n    return group;\n  };\n\n  /**\n   * Will return false if a url doesn't exist in any group,\n   * or the name of the group that contains the page if the url does exist.\n   */\n  groupForURL = (url: string): false | string => {\n    for (const groupName of this.availableGroups) {\n      const group = this.groupFor(groupName);\n      const page = group.list.find((page) => page.path === url);\n\n      if (page) {\n        return groupName;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * Returns the page entry for the current group\n   */\n  findByPath = (path: string) => {\n    return this.pages.find((page) => page.path === path || page.path === path + '.md');\n  };\n}\n","import { assert } from '@ember/debug';\nimport { getOwner } from '@ember/owner';\n\nimport type { Collection, Page } from '../types.ts';\nimport type Owner from '@ember/owner';\n\nexport function isCollection(x: Page | Collection): x is Collection {\n  return 'pages' in x;\n}\n\nexport function isIndex(x: Page | Collection) {\n  if (isCollection(x)) return false;\n\n  return x.path.endsWith('index');\n}\n\nexport function getIndexPage(x: Collection): Page | undefined {\n  const page = x.pages.find(isIndex);\n\n  if (page && isCollection(page)) return;\n\n  return page;\n}\n\n/////////////////////////////////\n// copied from ember-primitives\n// should these be exposed?\n/////////////////////////////////\n\n/**\n * Loose check for an \"ownerish\" API.\n * only the \".lookup\" method is required.\n *\n * The requirements for what an \"owner\" is are sort of undefined,\n * as the actual owner in ember applications has too much on it,\n * and the long term purpose of the owner will be questioned once we\n * eliminate the need to have a registry (what lookup looks in to),\n * but we'll still need \"Something\" to represent the lifetime of the application.\n *\n * Technically, the owner could be any object, including `{}`\n */\nexport function isOwner(x: unknown): x is Owner {\n  if (!isNonNullableObject(x)) return false;\n\n  return 'lookup' in x && typeof x.lookup === 'function';\n}\n\nexport function isNonNullableObject(x: unknown): x is NonNullable<object> {\n  if (typeof x !== 'object') return false;\n  if (x === null) return false;\n\n  return true;\n}\n\n/**\n * Can receive the class instance or the owner itself, and will always return return the owner.\n *\n * undefined will be returned if the Owner does not exist on the passed object\n *\n * Can be useful when combined with `createStore` to then create \"services\",\n * which don't require string lookup.\n */\nexport function findOwner(contextOrOwner: unknown): Owner | undefined {\n  if (isOwner(contextOrOwner)) return contextOrOwner;\n\n  // _ENSURE_ that we have an object, else getOwner makes no sense to call\n  if (!isNonNullableObject(contextOrOwner)) return;\n\n  const maybeOwner = getOwner(contextOrOwner);\n\n  if (isOwner(maybeOwner)) return maybeOwner;\n\n  return;\n}\n\nexport function forceFindOwner(contextOrOwner: unknown): Owner {\n  const maybe = findOwner(contextOrOwner);\n\n  assert(`Did not find owner. An owner is required`, maybe);\n\n  return maybe;\n}\n\ninterface LRUNode<V> {\n  key: unknown;\n  value: V;\n  prev: LRUNode<V>;\n  next: LRUNode<V>;\n}\n\nclass LRUCache<Value> {\n  #max: number;\n  #map = new Map<unknown, LRUNode<Value>>();\n  #head = {} as LRUNode<Value>;\n  #tail = {} as LRUNode<Value>;\n\n  constructor(max = 128) {\n    this.#max = max;\n    this.#head.next = this.#tail;\n    this.#tail.prev = this.#head;\n  }\n\n  get(key: unknown): Value | undefined {\n    const node = this.#map.get(key);\n\n    if (!node) return undefined;\n\n    this.#remove(node);\n    this.#insertAfterHead(node);\n\n    return node.value;\n  }\n\n  set(key: unknown, value: Value): void {\n    if (this.#map.has(key)) return;\n\n    const node = { key, value } as LRUNode<Value>;\n\n    this.#map.set(key, node);\n    this.#insertAfterHead(node);\n\n    if (this.#map.size > this.#max) {\n      this.#map.delete(this.#tail.prev.key);\n      this.#remove(this.#tail.prev);\n    }\n  }\n\n  #remove(node: LRUNode<Value>): void {\n    node.prev.next = node.next;\n    node.next.prev = node.prev;\n  }\n\n  #insertAfterHead(node: LRUNode<Value>): void {\n    node.next = this.#head.next;\n    node.prev = this.#head;\n    this.#head.next.prev = node;\n    this.#head.next = node;\n  }\n}\n\nconst defaultCache = new LRUCache<unknown>();\n\nexport function lru<Value, Key = unknown>(key: Key, compute: (key: Key) => Value): Value {\n  let value = defaultCache.get(key) as Value | undefined;\n\n  if (value === undefined) {\n    value = compute(key);\n    defaultCache.set(key, value);\n  }\n\n  return value;\n}\n"],"names":["selected","context","owner","getKey","createStore","Selected","loaderFor","path","docs","compiledDocs","getOwner","fn","wrapper","assert","module","default","state","compileText","promise","wrapped","getPromiseState","g","prototype","service","i","#docs","docsManager","loader","n","cached","use","keepLatest","value","when","Boolean","isLoading","prose","error","activeCompiled","resolved","isReady","isPending","hasError","message","currentGroup","name","String","hasProse","#path","router","currentURL","url","URL","window","location","origin","pathname","replace","#matchOrFirstPagePath","pages","createCache","findByPath","#page","getValue","#printError","console","group","info","manifest","groupEnd","DocsService","PREPARE_DOCS","Symbol","compilerOptions","topLevelScope","remarkPlugins","rehypePlugins","modules","md","scope","Shadowed","APIDocs","CommentQuery","ComponentSignature","ModifierSignature","HelperSignature","options","gmd","hbs","kolay","kolay/components","kolay/typedoc","apiDocs","typedocLoader","#selected","loadManifest","Promise","resolve","groups","setup","all","optionsForCompiler","setupCompiler","_packages","packageNames","loadApiDocs","_docs","list","tree","selectedGroup","first","split","availableGroups","includes","selectGroup","join","transitionTo","map","groupFor","groupName","find","groupForURL","page","isCollection","x","isIndex","endsWith","getIndexPage","isOwner","isNonNullableObject","lookup","findOwner","contextOrOwner","maybeOwner","forceFindOwner","maybe","LRUCache","Map","constructor","max","next","prev","get","key","node","undefined","set","has","size","delete","#remove","#insertAfterHead"],"mappings":"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"}
---
import MarkdownLayout from '../../layouts/MarkdownLayout.astro';
import { slugToTitle } from '../../utils/loadManifest';
import KolayPageWithSetup from '../../components/KolayPageWithSetup.gts';
import fs from 'node:fs';
import path from 'node:path';
import { glob } from 'glob';

// For SSG, we need to define all possible paths by reading the filesystem
export async function getStaticPaths() {
  // The docs are in the docs/ directory at the root of the project
  const docsDir = path.resolve(process.cwd(), '..', 'docs');
  
  // Find all markdown files
  const files = glob.sync('**/*.md', {
    cwd: docsDir,
    ignore: ['**/node_modules/**'],
  });
  
  return files.map(file => {
    // Remove .md extension to get the slug
    const slug = file.replace(/\.md$/, '');
    return {
      params: { slug }
    };
  });
}

const { slug } = Astro.params;
const title = slugToTitle(slug);
---

<MarkdownLayout title={title}>
  <!-- Use the component that properly initializes kolay -->
  <KolayPageWithSetup client:only="ember" />
</MarkdownLayout>
